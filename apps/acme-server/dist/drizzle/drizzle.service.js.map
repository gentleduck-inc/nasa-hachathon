{"version":3,"sources":["../../src/drizzle/drizzle.service.ts"],"sourcesContent":["import { _relations, tables } from '@aiv/db/tables'\nimport { ConfigService } from '@nestjs/config'\nimport { drizzle, NodePgDatabase } from 'drizzle-orm/node-postgres'\nimport { Pool } from 'pg'\n\nexport const schema = {\n  ...tables,\n  ..._relations,\n}\n\nexport const DrizzleAsyncProvider = 'DrizzleAsyncProvider'\n\nexport const drizzleProvider = [\n  {\n    provide: DrizzleAsyncProvider,\n    inject: [ConfigService],\n    useFactory: async (configService: ConfigService) => {\n      const connectionString = configService.get<string>('NEON_DATABASE_URL')\n      console.log(connectionString)\n      const pool = new Pool({ connectionString })\n      const _drizzle = drizzle(pool, { schema }) as NodePgDatabase<typeof schema>\n      console.log('âœ… Drizzle Connection initialized')\n      return _drizzle\n    },\n  },\n]\n"],"names":["DrizzleAsyncProvider","drizzleProvider","schema","tables","_relations","provide","inject","ConfigService","useFactory","configService","connectionString","get","console","log","pool","Pool","_drizzle","drizzle"],"mappings":";;;;;;;;;;;QAUaA;eAAAA;;QAEAC;eAAAA;;QAPAC;eAAAA;;;wBALsB;wBACL;8BACU;oBACnB;AAEd,MAAMA,SAAS;IACpB,GAAGC,cAAM;IACT,GAAGC,kBAAU;AACf;AAEO,MAAMJ,uBAAuB;AAE7B,MAAMC,kBAAkB;IAC7B;QACEI,SAASL;QACTM,QAAQ;YAACC,qBAAa;SAAC;QACvBC,YAAY,OAAOC;YACjB,MAAMC,mBAAmBD,cAAcE,GAAG,CAAS;YACnDC,QAAQC,GAAG,CAACH;YACZ,MAAMI,OAAO,IAAIC,QAAI,CAAC;gBAAEL;YAAiB;YACzC,MAAMM,WAAWC,IAAAA,qBAAO,EAACH,MAAM;gBAAEZ;YAAO;YACxCU,QAAQC,GAAG,CAAC;YACZ,OAAOG;QACT;IACF;CACD"}