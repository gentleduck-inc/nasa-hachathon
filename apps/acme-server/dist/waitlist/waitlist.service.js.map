{"version":3,"sources":["../../src/waitlist/waitlist.service.ts"],"sourcesContent":["import { Inject, Injectable } from '@nestjs/common'\nimport { NodePgDatabase } from 'drizzle-orm/node-postgres'\nimport { WINSTON_MODULE_NEST_PROVIDER, WinstonLogger } from 'nest-winston'\nimport { throwError } from '~/common/libs'\nimport { DrizzleAsyncProvider, schema } from '~/drizzle'\nimport { WaitlistErrorType } from './waitlist.types'\n\n@Injectable()\nexport class WaitlistService {\n  constructor(\n    @Inject(DrizzleAsyncProvider)\n    private db: NodePgDatabase<typeof schema>,\n    // @Inject(WINSTON_MODULE_NEST_PROVIDER)\n    // private readonly logger: WinstonLogger,\n  ) {}\n\n  async addToWishlist(data: { email: string }) {\n    try {\n      const email = await this.db\n        .insert(schema.wishlistTable)\n        .values({\n          email: data.email,\n        })\n        .returning()\n\n      if (!email.length) {\n        throw throwError<WaitlistErrorType>('WAITLIST_FAILED_TO_ADD')\n      }\n\n      return email\n    } catch (error) {\n      throw throwError<WaitlistErrorType>('WAITLIST_ERROR')\n    }\n  }\n}\n"],"names":["WaitlistService","addToWishlist","data","email","db","insert","schema","wishlistTable","values","returning","length","throwError","error"],"mappings":";;;;+BAQaA;;;eAAAA;;;wBARsB;8BACJ;sBAEJ;yBACkB;;;;;;;;;;;;;;;AAItC,IAAA,AAAMA,kBAAN,MAAMA;IAQX,MAAMC,cAAcC,IAAuB,EAAE;QAC3C,IAAI;YACF,MAAMC,QAAQ,MAAM,IAAI,CAACC,EAAE,CACxBC,MAAM,CAACC,eAAM,CAACC,aAAa,EAC3BC,MAAM,CAAC;gBACNL,OAAOD,KAAKC,KAAK;YACnB,GACCM,SAAS;YAEZ,IAAI,CAACN,MAAMO,MAAM,EAAE;gBACjB,MAAMC,IAAAA,gBAAU,EAAoB;YACtC;YAEA,OAAOR;QACT,EAAE,OAAOS,OAAO;YACd,MAAMD,IAAAA,gBAAU,EAAoB;QACtC;IACF;IAxBA,YACE,AACQP,EAAiC,CAGzC;aAHQA,KAAAA;IAGP;AAoBL"}